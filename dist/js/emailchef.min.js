"use strict";var WC_Emailchef=function(o){var t,l,s,n,a,c,i,r,d="wc_emailchef";return{go:function(){r=o("#"+d+"_lang"),t=o("#"+d+"_create_list"),l=o("#"+d+"_list"),s=o("#"+d+"_api_user"),n=o("#"+d+"_api_pass"),o("#"+d+"_new_name"),o("#"+d+"_new_description"),o("#"+d+"_new_save"),a=o("#"+d+"_policy_type"),c=o("#"+d+"_landing_page"),i=o("#"+d+"_fuck_page"),r.on("change",function(e){o.ajax({type:"POST",url:ajaxurl,data:{action:d+"_changelanguage",data:{lang:r.val()}},dataType:"json",success:function(e){confirm(e.msg)&&location.reload()},error:function(e,t,a){},complete:function(){}})}),t.on("click",function(e){e.preventDefault(),o(".tr-info-color").length||t.closest("tr").after('<tr class="tr-info-color" valign="top"><th scope="row" class="titledesc"><label for="wc_emailchef_new_name">'+wcec.list_name+'</label></th><td class="forminp forminp-text"><input name="wc_emailchef_new_name" id="wc_emailchef_new_name" type="text" dir="ltr" style="min-width:350px;" value="" class="" placeholder="'+wcec.list_name_placeholder+'">‎</td></tr><tr class="tr-info-color" valign="top"><th scope="row" class="titledesc"><label for="wc_emailchef_new_description">'+wcec.list_description+'</label></th><td class="forminp forminp-text"><input name="wc_emailchef_new_description" id="wc_emailchef_new_description" type="text" dir="ltr" style="min-width:350px;" value="" class="" placeholder="'+wcec.list_description_placeholder+'">‎</td></tr><tr class="tr-info-color" valign="top"><th scope="row" class="titledesc"><label for="wc_emailchef_new_save">'+wcec.create_label+'</label></th><td class="forminp forminp-text"><button name="wc_emailchef_save" class="button-primary woocommerce-save-button" id="wc_emailchef_new_save" >'+wcec.create+'</button>‎&nbsp;&nbsp;<button name="wc_emailchef_undo" class="button woocommerce-undo-button" id="wc_emailchef_undo_save" >'+wcec.undo+'</button>‎</td></tr><tr class="tr-info-color" valign="top"><td colspan="2">'+wcec.info+"</td></tr>")}),o(document).on("click","#"+d+"_new_save",function(e){var t,a,c;e.preventDefault(),t=s.val(),a=n.val(),e=o("#"+d+"_new_name").val(),c=o("#"+d+"_new_description").val(),l.attr("disabled","disabled"),o.post(ajaxurl,{action:d+"_add_list",data:{api_user:t,api_pass:a,list_name:e,list_desc:c}},function(e){console.log(e);e=o.parseJSON(e);"success"===e.type?(o(".tr-info-color").remove(),u(t,a,e.list_id)):alert(e.msg)})}),o(document).on("click","#"+d+"_undo_save",function(e){e.preventDefault(),o(".tr-info-color").remove()}),a.on("change",function(e){e.preventDefault(),"sopt"===o(this).val()?(c.closest("tr").fadeOut(),i.closest("tr").fadeOut()):(c.closest("tr").fadeIn(),i.closest("tr").fadeIn())}),l.closest("tr").hide(),o("#"+d+"_api_user, #"+d+"_api_pass").change(function(){e(s.val(),n.val(),!0)}),e(s.val(),n.val(),!1)}};function _(e){var t=n.closest("tr").nextAll("tr");"show"===e?t.fadeIn():t.fadeOut()}function p(e){"show"===e?a.closest("tr").css("display","table-row"):(a.find("option[value='dopt']").attr("selected","selected"),a.closest("tr").fadeOut())}function e(t,a,c){_("hide"),o("button[name='save']").attr("disabled","disabled"),o("#check_login_data").remove(),""!==t&&""!==a&&(o('<span id="check_login_data">'+wcec.check_data+"</span>").insertAfter(s),l.attr("disabled","disabled"),o.post(ajaxurl,{action:d+"_account",data:{api_user:t,api_pass:a}},function(e){o("button[name='save']").removeAttr("disabled");e=o.parseJSON(e);"error"==e.type?o("#check_login_data").removeClass().addClass("error").html('<i class="dashicons dashicons-warning"></i> '+wcec.error_login):(o("#check_login_data").removeClass().addClass("success").html('<i class="dashicons dashicons-yes"></i>'),_("show"),console.log("Policy = "+e.policy),"premium"!==e.policy?(console.log("Policy != premium, remove other policy options"),p("hide")):p("show"),l.removeAttr("disabled"),c&&(console.log("Loading lists..."),u(t,a,-1)))}))}function u(e,t,s){l.attr("disabled","disabled"),o.post(ajaxurl,{action:d+"_lists",data:{api_user:e,api_pass:t}},function(e){var a,c,e=o.parseJSON(e);"success"===e.type&&(a=!1,c=l.select2("val"),l.select2("destroy"),l.removeAttr("disabled"),l.empty(),o.each(e.lists,function(e,t){e===c&&(a=!0),l.prepend(o("<option></option>").attr("value",e).text(t))}),l.select2(),-1!==s?(console.log("Seleziono lista creata: "+s),l.select2("val",s).trigger("change")):a&&l.select2("val",c).trigger("change"))})}}(jQuery);